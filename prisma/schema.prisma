// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

model User {
  id                   String   @id @default(cuid())
  name                 String
  username             String   @unique @map("email")
  password             String
  role                 UserRole @default(CLIENT)
  balance              Float    @default(0)
  parentId             String?
  commissionPercentage Float    @default(100)
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt

  // Relations
  bets                 Bet[]
  wallet               Wallet?
  parent                User?     @relation("UserHierarchy", fields: [parentId], references: [id])
  children              User[]     @relation("UserHierarchy")
  sentTransfers         TransferTransaction[] @relation("SentTransfers")
  receivedTransfers     TransferTransaction[] @relation("ReceivedTransfers")

  @@map("users")
}

model Wallet {
  id        String   @id @default(cuid())
  userId    String   @unique
  balance   Float    @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  transactions Transaction[]

  @@map("wallets")
}

model Match {
  id          String      @id @default(cuid())
  homeTeam    String
  awayTeam    String
  startTime   DateTime
  status      MatchStatus @default(UPCOMING)
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt

  // Relations
  bets        Bet[]

  @@map("matches")
}

model Bet {
  id        String    @id @default(cuid())
  userId    String
  matchId   String
  amount    Float
  odds      Float
  selectionId Int?
  betType   String?
  betName   String?
  marketName String?
  marketType String?
  gtype     String?
  betValue  Float?
  betRate   Float?
  winAmount Float?
  lossAmount Float?
  settlementId String?
  toReturn  Float?
  metadata  Json?
  status    BetStatus @default(PENDING)
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  // Relations
  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  match     Match     @relation(fields: [matchId], references: [id], onDelete: Cascade)

  @@map("bets")
}

model Transaction {
  id          String            @id @default(cuid())
  walletId    String
  amount      Float
  type        TransactionType
  description String?
  createdAt   DateTime          @default(now())

  // Relations
  wallet     Wallet            @relation(fields: [walletId], references: [id], onDelete: Cascade)

  @@map("transactions")
}

model TransferTransaction {
  id              String   @id @default(cuid())
  fromUserId      String
  toUserId        String
  amount          Float
  commissionPercentage Float
  finalAmount     Float
  commissionAmount Float
  status          TransferStatus @default(COMPLETED)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relations
  fromUser        User     @relation("SentTransfers", fields: [fromUserId], references: [id], onDelete: Cascade)
  toUser          User     @relation("ReceivedTransfers", fields: [toUserId], references: [id], onDelete: Cascade)

  @@map("transfer_transactions")
}

enum MatchStatus {
  UPCOMING
  LIVE
  FINISHED
  CANCELLED
}

enum BetStatus {
  PENDING
  WON
  LOST
  CANCELLED
}

enum UserRole {
  SUPER_ADMIN
  ADMIN
  AGENT
  CLIENT
}

enum TransactionType {
  DEPOSIT
  WITHDRAWAL
  BET_PLACED
  BET_WON
  BET_LOST
  REFUND
}

enum TransferStatus {
  PENDING
  COMPLETED
  FAILED
  CANCELLED
}

enum TransferLogType {
  TOPUP
  TOPDOWN
}

model TransferLog {
  id        String          @id @default(cuid())
  fromUserId String
  toUserId   String
  amount     Float
  remarks    String?
  type       TransferLogType
  createdAt  DateTime       @default(now())

  @@map("transfer_logs")
}
